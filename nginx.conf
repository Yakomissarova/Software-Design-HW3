events {
    worker_connections 1024;
}

http {
    server {
        listen 80;

        location = / {
            return 200 'API Gateway is running. Use /storage, /check or /scalar';
            add_header Content-Type text/plain;
        }

        location /storage/ {
            proxy_pass http://storage-service:8080/;
            proxy_set_header Host $host;
        }

        location /storage/openapi.json {
            proxy_pass http://storage-service:8080/swagger/v1/swagger.json;
        }

        location /check/ {
            proxy_pass http://check-service:8080/;
            proxy_set_header Host $host;
        }
)
        location /check/openapi.json {
            proxy_pass http://check-service:8080/swagger/v1/swagger.json;
        }

        location = /files {
            proxy_pass http://storage-service:8080/files;
            proxy_set_header Host $host;
        }

        location = /submissions {
            proxy_pass http://check-service:8080/submissions;
            proxy_set_header Host $host;
        }

        location /assignments/ {
            proxy_pass http://check-service:8080/assignments/;
            proxy_set_header Host $host;
        }

        location = /scalar {
            return 301 $scheme://$http_host/scalar/;
        }

        location /scalar/ {
            proxy_pass http://scalar:8080/;
        }
    }
}
